[["index.html", "Spotify Songs Chapter 1 Introduction", " Spotify Songs Junhao Zhang, Wei Luo, Yihan Wang 2021-11-19 Chapter 1 Introduction "],["data-sources.html", "Chapter 2 Data sources", " Chapter 2 Data sources "],["data-transformation.html", "Chapter 3 Data transformation", " Chapter 3 Data transformation "],["missing-values.html", "Chapter 4 Missing values", " Chapter 4 Missing values missing_value_plot&lt;-function(data,type=&#39;counts&#39;){ # find and count the missing patterns missing_patterns &lt;- data.frame(is.na(data)) %&gt;% group_by_all() %&gt;% count(name = &quot;count&quot;, sort = TRUE) %&gt;% ungroup() # add id to each row missing_patterns &lt;- missing_patterns %&gt;% mutate(id=row_number(),.before=1) # tidy the missing patterns new_missing_patterns &lt;- missing_patterns %&gt;% mutate_if(is.logical, as.character) #mutate_all(funs(as.character(.))) for (i in 1:nrow(new_missing_patterns)) { flag &lt;-0 for (j in 2:ncol(new_missing_patterns)) { if (new_missing_patterns[i,j]==&#39;TRUE&#39;) { flag &lt;- 1 } } if (flag==0) { new_missing_patterns[i,2:(ncol(new_missing_patterns)-1)] &lt;-&#39;complete&#39; } } tidypatterns &lt;- new_missing_patterns %&gt;% select(-count) %&gt;% pivot_longer(cols=!id,names_to =&#39;key&#39;,values_to=&#39;value&#39;) # Plot the main graph column_sum &lt;- colSums(is.na(data)) variable_order &lt;- names(sort(column_sum,decreasing = TRUE)) variable &lt;- fct_relevel(tidypatterns$key,variable_order) main &lt;- ggplot(tidypatterns,aes(x=variable,y=fct_rev(factor(id)),fill=value))+ geom_tile(color = &quot;white&quot;)+ scale_fill_manual(values = c(&#39;TRUE&#39;=&#39;darkorchid1&#39;,&#39;FALSE&#39;=&#39;grey&#39;,&#39;complete&#39;=&#39;darkgrey&#39;))+ theme(legend.position = &quot;none&quot;)+ labs(x=&#39;variable&#39;,y=&#39;missing pattern&#39;) # add text complete_loc &lt;- tidypatterns$id[which(tidypatterns$value==&#39;complete&#39;)] x &lt;- as.integer(ncol(data)/2)+1 for (i in complete_loc) { y &lt;- nrow(missing_patterns)-i+1 main &lt;- main+geom_text(aes(x=x,y=y,label=&#39;complete case&#39;),size=4,family=&quot;Times New Roman&quot;,fontface=&#39;bold&#39;) } if (type==&#39;counts&#39;){ # plot the top graph column_count&lt;-data %&gt;% summarise_all(~ sum(is.na(.x))) %&gt;% pivot_longer(cols=everything(), names_to=&quot;variable&quot;, values_to=&quot;count&quot;) %&gt;% arrange(desc(count)) top &lt;- ggplot(column_count,aes(x=factor(variable, levels=column_count$variable), y=count))+ geom_col(fill=&#39;lightblue&#39;)+ labs(x=&#39;&#39;,y=&#39;num rows missing:&#39;)+ ggtitle(&#39;Missing Value Patterns with counts&#39;) # plot the right graph row_count &lt;-new_missing_patterns %&gt;% add_column(status=&#39;missing&#39;) for (i in 1:nrow(row_count)) { if (any(row_count[i,]==&#39;complete&#39;)){ row_count[i,&#39;status&#39;]&lt;-&#39;complete&#39; } } right &lt;- ggplot(row_count,aes(x=count,y=fct_rev(factor(id)),fill=status))+ geom_col()+ scale_fill_manual(values=c(&#39;blue&#39;,&#39;lightblue&#39;))+ theme(legend.position = &quot;none&quot;)+ labs(x=&#39;row count&#39;,y=&#39;&#39;) } else if (type==&#39;percents&#39;){ # plot the top graph column_count &lt;- data %&gt;% summarise_all(~ 100*sum(is.na(.x))/nrow(data)) %&gt;% pivot_longer(cols=everything(), names_to=&quot;variable&quot;, values_to=&quot;count&quot;) %&gt;% arrange(desc(count)) top &lt;- ggplot(column_count,aes(x=factor(variable, levels=column_count$variable), y=count))+ geom_col(fill=&#39;lightblue&#39;)+ scale_y_continuous(limits=c(0,100),breaks=seq(0,100,by=25))+ labs(x=&#39;&#39;,y=&#39;% rows missing:&#39;)+ ggtitle(&#39;Missing Value Patterns with percents&#39;) # plot the right graph row_count &lt;-new_missing_patterns %&gt;% add_column(status=&#39;missing&#39;) %&gt;% mutate(count=100*(count/nrow(data))) %&gt;% arrange(desc(count)) for (i in 1:nrow(row_count)) { if (any(row_count[i,]==&#39;complete&#39;)){ row_count[i,&#39;status&#39;]&lt;-&#39;complete&#39; } } right &lt;- ggplot(row_count,aes(x=count,y=fct_rev(factor(id)),fill=status))+ geom_col()+ scale_fill_manual(values=c(&#39;blue&#39;,&#39;lightblue&#39;))+ scale_x_continuous(limits=c(0,100),breaks=seq(0,100,by=25))+ theme(legend.position = &quot;none&quot;)+ labs(x=&#39;% rows&#39;,y=&#39;&#39;) } else (print(&#39;Wrong Type Input&#39;)) top + plot_spacer() + main + right + plot_layout( ncol = 2, nrow = 2, widths = c(4, 1), heights = c(1, 4) ) } missing_value_plot(ggplot2::economics,type=&#39;counts&#39;) missing_value_plot(ggplot2::economics,type=&#39;percents&#39;) df_c&lt;-Lock5withR::HollywoodMovies2011 colnames(df_c)&lt;-c(&#39;Movie&#39;,&#39;LS&#39;,&#39;RT&#39;,&#39;AS&#39;,&#39;Story&#39;,&#39;Genre&#39;,&#39;TOW&#39;, &#39;BOAPW&#39;,&#39;DG&#39;,&#39;FG&#39;,&#39;WG&#39;,&#39;Budget&#39;,&#39;Profit&#39;,&#39;OW&#39;) missing_value_plot(df_c,type=&#39;counts&#39;) missing_value_plot(df_c,type=&#39;percents&#39;) We have found that our final data set has missing values in only few rows which is not really useful. We decided to omit them and use the ucla_textbooks_f18 data set in openintro package. library(openintro) missing_value_plot(openintro::ucla_textbooks_f18,type=&#39;counts&#39;) missing_value_plot(openintro::ucla_textbooks_f18,type=&#39;percents&#39;) According to the plot above, we can tell that there are 20 missing patterns and the fifth missing pattern is a complete case. The fisrt missing patterns has the highest row count. It seems that there is correlation between the price of new books and used books both in amazon and in bookstore because they all have really high missing values compared with other variables. Also, it’s quiet strange that there are so many missing values in book price variables. Regarding of book features,textbook_isbn is more likely to be missing than any other book features except price because book isbn is long and complicated and people normally won’t use isbn much when they buy books. There are three columns, year,term and subject doesn’t have missing values. One interesting observation is that there are no missing values in subject, but there are missing values in Subject abbreviation which means that some book are not used for one specific subject but for multiple subjects and that’s why the subject abbr is missing because it doesn’t know how to fill in the subject abbreviation. "],["results.html", "Chapter 5 Results", " Chapter 5 Results "],["interactive-component.html", "Chapter 6 Interactive component", " Chapter 6 Interactive component "],["conclusion.html", "Chapter 7 Conclusion", " Chapter 7 Conclusion "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
