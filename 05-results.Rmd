# Results
```{r, echo=FALSE,message=FALSE,warning=FALSE}
#install.packages('spotifyr')
library('spotifyr')
#library(here)
library(readr)
library(tidyverse)
library(socviz)
library(dplyr)
library("ggpubr")
library('tidytuesdayR')
library(aod)
library(ramify)
library(car)
spotify_songs <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-21/spotify_songs.csv',show_col_types = FALSE)
songs_info <- spotify_songs %>%
  select(-c(track_id,track_name,track_artist,track_album_id,track_album_name,track_album_release_date,playlist_name,playlist_id,playlist_subgenre))
```
In this section, we are going to learn relationships between different features and relationships between features and label.

# Statistics of each genre 

First, we can get some statistics of each genre of songs:
```{r}
ggplot(songs_info, aes(x = playlist_genre, fill = playlist_genre))+
  geom_bar(width=1)+
  coord_polar()+
  theme_void()
```

from this pie chart, we can conclude that every genre has relatively same size of data, and no genre is biased (missing enough data for classification model).

we also can plot a Cleveland dot plots for all genre in order to see detailed statistics of each genre:
```{r}
library(openintro)
library(dbplyr)
table <- count(songs_info, playlist_genre)
table
ggplot(table, aes(x = n, y = fct_reorder(playlist_genre, n))) + geom_point(color = "blue") +
  theme_linedraw() 
```
From the Cleveland dot plot, we can see that edm genre has the most data, while rap and pop are the second and third popular ones. 

# Density curves

```{r}
feature_names <- c(names(songs_info)[0:1], names(songs_info)[3:14])

x <- pivot_longer(dplyr::select(songs_info, c('playlist_genre', feature_names)), cols = feature_names)
  ggplot(x, aes(x = value)) +
  geom_density(aes(color = playlist_genre)) +
  facet_wrap(~name, ncol = 3, scales = 'free')
```

on the above density curves, as we are trying to find the difference between each genre, we want density curves to seperate as much as it can so that we can observe some differences. Therefore, among all the features, danceability, duration_ms, energy, speechiness, loudness, valence, and track_popularity, and tempo will be studied.

# QQ plot 
```{r}
p1 <- qqPlot(songs_info$track_popularity)
p2 <- qqPlot(songs_info$danceability)
p3 <- qqPlot(songs_info$duration_ms)
p4 <- qqPlot(songs_info$energy)
p5 <- qqPlot(songs_info$speechiness)
p6 <- qqPlot(songs_info$loudness)
p7 <- qqPlot(songs_info$valence)
p8 <- qqPlot(songs_info$tempo)
```
From QQ plot, we can tell that danceability and tempo follows normal distribution, while others deviate from normal distribution.


# Box Plot
we can also plot a box-whisker plot for every feature against each genre:
```{r}
p1 <- songs_info %>% ggplot(aes(x = playlist_genre, y = valence)) +
  geom_boxplot(alpha = 0.7) +
  theme_bw() +
  labs(x= 'Genres', y = 'Happiness' )

#Energy

p2 <- songs_info %>% ggplot(aes(x = playlist_genre, y = energy)) +
  geom_boxplot(alpha = 0.7) +
  theme_bw() +
  labs(x= 'Genres', y = 'energy' )

#Danceability
p3 <- songs_info %>% ggplot(aes(x = playlist_genre, y = danceability)) +
  geom_boxplot(alpha = 0.7) +
  theme_bw() +
  labs(x= 'Genres', y = 'danceability' )

#Tempo
p4 <- songs_info %>% ggplot(aes(x = playlist_genre, y = tempo)) +
  geom_boxplot(alpha = 0.7) +
  theme_bw() +
  labs(x= 'Genres', y = 'tempo' )

p5 <- songs_info %>% ggplot(aes(x = playlist_genre, y = loudness)) +
  geom_boxplot(alpha = 0.7) +
  theme_bw() +
  labs(x= 'Genres', y = 'loudness' )

p6 <- songs_info %>% ggplot(aes(x = playlist_genre, y = speechiness)) +
  geom_boxplot(alpha = 0.7) +
  theme_bw() +
  labs(x= 'Genres', y = 'speechiness' )

p7 <- songs_info %>% ggplot(aes(x = playlist_genre, y = duration_ms)) +
  geom_boxplot(alpha = 0.7) +
  theme_bw() +
  labs(x= 'Genres', y = 'duration_ms' )

p8 <- songs_info %>% ggplot(aes(x = playlist_genre, y = track_popularity)) +
  geom_boxplot(alpha = 0.7) +
  theme_bw() +
  labs(x= 'Genres', y = 'track_popularity' )

ggarrange(p1,p2,p3,p4,p5,p6,p7,p8,  nrow = 3, ncol = 3)
```

Happiness: It is the only feature without many outliers. Latin's mean and percentiles are higher than all other genre. Edm's mean and percentiles is lowest, while all others remain similar to each other.

Energy: edm has the highest energy and rock might have the highest variance probably. r&b has the lowest energy, which is expected.

Danceability: rock has the lowest mean danceability, while other genre are on the same level. There are a lot of low outliers for all genre.

tempo: we are unable to see any trend for edm on this feature, while for other genre, we can see some high outliers and mean of tempo are one the same level for every genre.

loudness: as the loudness for nearly all the genre are looking similar, and variance of the loudness seems low, and there are lots of low outliers for each genre.

speechiness: among all the genre, rap's speechiness is the highest. and speechiness for r&b and latin are similar, while all others remains every low speechiness.

duration_ms: from the box plot above, we can see that r&b and rock's duration a little higher than all other four genre, which are all on the same level. 

track_popularity: edm has the lowest popularity, and pop and latin have the highest.


# Correlation within features
In order to fit a regression model on the dataset, we first need to study the correlation between all features and reduce features dimension. Below is a plot for all features' correlation:
```{r}
  corrplot::corrplot(cor(scale(dplyr::select(songs_info, feature_names))),
                     method = 'color', 
                     diag = FALSE, 
                     addCoef.col = "black",
                     number.cex = .6,
                     col = colorRampPalette(colors = c('red','white','green'))(1000),
                     number.digits = 1.
                     )
```

We can see that the correlation between loudness and energy, acousticness and energy are very high, therefore, we can plot relationships between them to understand better:

```{r}
ggarrange(
  ggplot(songs_info, aes(energy,loudness)) +
  geom_point(color = 'red', ) +
  geom_smooth(),
  
  ggplot(songs_info, aes(energy,acousticness)) +
  geom_point(color = 'red', ) +
  geom_smooth())
```

From the above plots, we can infer that as loudness increases, energy increases. As acousticness increases, energy decreases. 